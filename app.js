console.log("app.js å·²æˆåŠŸåŠ è½½ï¼");

// è§’è‰²çŠ¶æ€
let hunger = 100;
let money = 100;
let paintings = [];
let actionPoints = 12;
let day = 1;
let typingTimeout = null; // è§£å†³å¯¹è¯åˆ·æ–°ä¹±ç é—®é¢˜

// **å­˜æ¡£åŠŸèƒ½**
function saveGame() {
    let gameState = { hunger, money, paintings, actionPoints, day };
    localStorage.setItem("gothamLifeSave", JSON.stringify(gameState));
}

// **è¯»å–å­˜æ¡£**
function loadGame() {
    let saveData = localStorage.getItem("gothamLifeSave");
    if (saveData) {
        let gameState = JSON.parse(saveData);
        hunger = gameState.hunger;
        money = gameState.money;
        paintings = gameState.paintings;
        actionPoints = gameState.actionPoints;
        day = gameState.day;
    }
}

// **æ¸…é™¤å­˜æ¡£**
function resetGame() {
    localStorage.removeItem("gothamLifeSave");
    hunger = 100;
    money = 100;
    paintings = [];
    actionPoints = 12;
    day = 1;
    updateStatus();
}

// **æ›´æ–° UIï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æ¸¸æˆç»“æŸ**
function updateStatus() {
    document.getElementById("day").innerText = day;
    document.getElementById("ap").innerText = actionPoints;
    document.getElementById("hunger").innerText = hunger;
    document.getElementById("money").innerText = money;
    document.getElementById("paintings").innerText = paintings.length;

    // **ä¿®å¤ï¼šå½“é¥±é£Ÿåº¦ä¸º 0 æ—¶ï¼Œç»“æŸæ¸¸æˆ**
    if (hunger <= 0) {
        alert("ä½ å› é¥¥é¥¿è¿‡åº¦æ™•å€’äº†ï¼Œæ¸¸æˆç»“æŸã€‚");
        resetGame();
        return;
    }

    saveGame();
}

// **ç¡®ä¿æ°æ£®å¯¹è¯æ¡†å­˜åœ¨**
function checkJasonDialogueBox() {
    if (!document.getElementById("jasonDialogue")) {
        console.error("âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° #jasonDialogue");
        return false;
    }
    return true;
}

// **é€æ­¥æ˜¾ç¤ºæ°æ£®çš„å¯¹è¯**
function showJasonDialogue(dialogue) {
    if (!checkJasonDialogueBox()) return; // ç¡®ä¿å¯¹è¯æ¡†å­˜åœ¨

    let dialogueBox = document.getElementById("jasonDialogue");
    dialogueBox.innerHTML = ""; // æ¸…ç©ºå¯¹è¯æ¡†
    let index = 0;

    // **ä¿®å¤ï¼šæ¸…é™¤ä¹‹å‰çš„æ‰“å­—è®¡æ—¶å™¨ï¼Œé˜²æ­¢ä¹±ç **
    if (typingTimeout) clearTimeout(typingTimeout);

    function typeNext() {
        if (index < dialogue.length) {
            dialogueBox.innerHTML += dialogue[index];
            index++;
            typingTimeout = setTimeout(typeNext, 40); // 40ms æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
        }
    }

    typeNext();
}

// **æ°æ£®çš„å‰§æƒ…å¯¹è¯**
function chatWithJason() {
    if (!document.getElementById("jasonDialogue")) {
        console.error("âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° #jasonDialogue");
        return;
    }

    let dialogues = [
        // ğŸ”´ ç»å…¸å¯¹è¯
        "æ°æ£®ï¼šå“¥è°­çš„è¡—å¤´æ°¸è¿œä¸å®‰å…¨ã€‚\nä»–å€šé åœ¨å¢™ä¸Šï¼Œçœ¼ç¥æ¸¸ç¦»äº†ä¸€ä¼šå„¿ï¼Œåƒæ˜¯æƒ³åˆ°äº†ä»€ä¹ˆä¸å¤ªæ„‰å¿«çš„å›å¿†ã€‚",
        "æ°æ£®ï¼šä»Šå¤©é‡åˆ°äº†è¿ªå…‹ï¼Œæˆ‘ä»¬èŠäº†èŠã€‚\nä»–å‹¾èµ·å˜´è§’ï¼Œåƒæ˜¯åœ¨å›å¿†ä»€ä¹ˆã€‚'è¿™å®¶ä¼™è¿˜æ˜¯é‚£ä¹ˆå¤šè¯ï¼Œä¸è¿‡è‡³å°‘ä»–è¿˜æ„¿æ„å¬æˆ‘è¯´ç‚¹ä»€ä¹ˆã€‚'",
        "æ°æ£®ï¼šæœ‰æ—¶å€™ï¼Œæˆ‘åœ¨æƒ³å¦‚æœå¸ƒé²æ–¯â€¦â€¦\nä»–çš„è¯è¯­æ–­åœ¨åŠç©ºä¸­ï¼Œæœ€ç»ˆè¿˜æ˜¯æ²¡æœ‰ç»§ç»­ä¸‹å»ã€‚æ²‰é»˜ä¸­ï¼Œä½ éšçº¦å¬è§ä»–ä½å£°å¹æ¯ã€‚",
        "æ°æ£®ï¼šä½ ä¸€ä¸ªäººä½åœ¨è¿™ç ´åœ°æ–¹ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿ\nä»–çš±ç€çœ‰ï¼Œçœ‹ç€ä½ ä½çš„å…¬å¯“æ¥¼ï¼Œçœ¼ç¥æœ‰äº›ä¸æ”¾å¿ƒã€‚'å¦‚æœæœ‰äº‹ï¼Œç»™æˆ‘æ‰“ç”µè¯ã€‚'ä»–çš„è¯­æ°”é‡Œå¸¦ç€ä¸å®¹ç½®ç–‘çš„åšå®šã€‚",
        "æ°æ£®ï¼šå“¥è°­çš„è­¦å¯Ÿï¼Ÿä½ çœŸè§‰å¾—ä»–ä»¬ä¼šç®¡ä½ çš„æ­»æ´»ï¼Ÿ\nä»–å†·ç¬‘äº†ä¸€å£°ï¼Œçœ¼ç¥é‡Œå¸¦ç€å‡ åˆ†ä¸ä¿¡ä»»ã€‚'ä»–ä»¬èƒ½åšçš„ï¼Œæ°¸è¿œéƒ½åªæ˜¯å–„åã€‚ç­‰ä»–ä»¬æ¥äº†ï¼Œé€šå¸¸å·²ç»å¤ªè¿Ÿäº†ã€‚'",

        // ğŸ”´ å…³å¿ƒ & äº’åŠ¨
        "æ°æ£®ï¼šä½ ä¸Šæ¬¡åƒé¥­æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ\nä»–çš„è¯­æ°”åƒæ˜¯åœ¨éšå£ä¸€é—®ï¼Œä½†å½“ä½ æƒ³æ•·è¡è¿‡å»æ—¶ï¼Œä»–å´çš±èµ·çœ‰ã€‚'åˆ«éª—æˆ‘ã€‚ä½ çœ‹èµ·æ¥åƒæ˜¯å‡ å¤©æ²¡å¥½å¥½åƒé¥­äº†ã€‚'",
        "æ°æ£®ï¼šä½ æœ€è¿‘åœ¨ç”»ä»€ä¹ˆï¼Ÿ\nä»–é è¿‘äº†ä¸€ç‚¹ï¼Œç›®å…‰è½åœ¨ä½ çš„ç”»æ¶ä¸Šã€‚'è®©æˆ‘çœ‹çœ‹ã€‚'ä»–çš„è¯­æ°”å¾ˆéšæ„ï¼Œä½†ä½ çŸ¥é“ï¼Œä»–æ˜¯çœŸçš„æ„Ÿå…´è¶£ã€‚",
        "æ°æ£®ï¼šä½ çŸ¥é“å—ï¼Ÿä½ å’Œä»–ä»¬ä¸ä¸€æ ·ã€‚\nä»–çš„è¯è®©ä½ æ„£äº†ä¸€ä¸‹ã€‚ä»–æ²¡æœ‰è§£é‡Šï¼Œåªæ˜¯è½»è½»ç¬‘äº†ç¬‘ï¼Œçœ¼ç¥ä¸­é—ªè¿‡ä¸€ä¸ä¸æ˜“å¯Ÿè§‰çš„æƒ…ç»ªã€‚",
        "æ°æ£®ï¼šä½ çš„é‹å¸¦æ¾äº†ã€‚\nä»–çš„è¯­æ°”æ·¡æ·¡çš„ï¼Œä½†å½“ä½ ä½å¤´å‡†å¤‡ç³»é‹å¸¦æ—¶ï¼Œä»–å·²ç»è¹²ä¸‹ï¼ŒåŠ¨ä½œåˆ©è½åœ°å¸®ä½ ç»‘å¥½ã€‚'åˆ«è®©è‡ªå·±æ‘”äº†ã€‚'",

        // ğŸ”´ æ°æ£®çš„å›å¿†
        "æ°æ£®ï¼šå°æ—¶å€™ï¼Œæˆ‘ç»å¸¸åœ¨é›¨é‡Œè·‘ã€‚\nä»–éšæ„åœ°æèµ·ï¼Œå¥½åƒè¿™åªæ˜¯ä¸ªå°äº‹ã€‚'æˆ‘å–œæ¬¢é›¨ã€‚å®ƒèƒ½ç›–ä½ä¸€åˆ‡å£°éŸ³ï¼Œä¹Ÿèƒ½æ´—æ‰è¡€è¿¹ã€‚'",
        "æ°æ£®ï¼šæˆ‘ä»¥å‰å¾ˆå–œæ¬¢æ”¶é›†æ‰“ç«æœºã€‚\nä»–ç‚¹ç‡ƒä¸€æ ¹ç«æŸ´ï¼Œå‡è§†ç€å¾®å¼±çš„ç«å…‰ã€‚'å¯èƒ½æ˜¯å› ä¸ºç«æ€»èƒ½å¸¦æ¥æŸç§ç»ˆç»“å§ã€‚'",
        "æ°æ£®ï¼šä½ çŸ¥é“å—ï¼Ÿæˆ‘å°æ—¶å€™ä¼šå·æ±½è½¦ã€‚\nä»–çš„è¯­æ°”å¹³é™å¾—å¯æ€•ï¼Œä»¿ä½›è¿™åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ç«¥å¹´å›å¿†ã€‚'æˆ‘å¾ˆæ“…é•¿è¿™ä¸ªï¼Œç›´åˆ°å¸ƒé²æ–¯æ‰¾åˆ°æˆ‘ã€‚'",
        "æ°æ£®ï¼šæœ‰æ—¶å€™ï¼Œæˆ‘ä¹Ÿä¼šæ¢¦åˆ°è¿‡å»ã€‚\nä»–çš„è¯­æ°”æœ‰äº›ä½è½ã€‚'ä½†æ¢¦é‡Œï¼Œæ€»æ˜¯æœ‰æªå£°ã€‚'ä»–é¡¿äº†é¡¿ï¼Œè½»è½»ç¬‘äº†ç¬‘ï¼Œ'æˆ‘æƒ³æˆ‘å·²ç»ä¹ æƒ¯äº†ã€‚'",

        // ğŸ”´ å“¥è°­çš„é˜´å½± & ä¼ç¬”
        "æ°æ£®ï¼šå“¥è°­ä¼šåå™¬ä¸€åˆ‡ã€‚\nä»–çœ‹ç€è¿œå¤„çš„è¡—é“ï¼Œç¯å…‰åœ¨ä»–è„¸ä¸ŠæŠ•ä¸‹æ–‘é©³çš„é˜´å½±ã€‚'åŒ…æ‹¬æˆ‘ä»¬ã€‚'",
        "æ°æ£®ï¼šæ˜¨æ™šæˆ‘å‘ç°äº†ä¸€ç‚¹æœ‰è¶£çš„ä¸œè¥¿ã€‚\nä»–é åœ¨æ¡Œè¾¹ï¼Œä¿®é•¿çš„æ‰‹æŒ‡è½»æ•²ç€æ¡Œé¢ã€‚'å…³äºé»‘é¢å…·çš„è´§ç‰©ï¼Œè¿˜æœ‰ä¸€äº›â€¦â€¦ä¸è¯¥å‡ºç°åœ¨å“¥è°­çš„äººã€‚'",
        "æ°æ£®ï¼šä½ è§‰å¾—ä½ èƒ½åœ¨è¿™åº§åŸå¸‚æ´»å¤šä¹…ï¼Ÿ\nä»–è¯´å¾—å¾ˆå¹³é™ï¼Œåƒæ˜¯åœ¨é—®ä½ ä»Šå¤©æƒ³åƒä»€ä¹ˆã€‚ä½†ä½ çŸ¥é“ä»–æ˜¯è®¤çœŸçš„ã€‚",
        "æ°æ£®ï¼šæœ‰æ—¶å€™ï¼Œæˆ‘ä¼šæƒ³ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¯¥å½»åº•ç¦»å¼€è¿™é‡Œã€‚\nä»–é åœ¨çª—è¾¹ï¼Œå‡è§†ç€è¿œå¤„çš„éœ“è™¹ç¯ï¼Œå˜´è§’çš„ç¬‘æ„å¸¦ç€å‡ åˆ†è‹¦æ¶©ã€‚'ä½†äº‹å®æ˜¯ï¼Œæˆ‘ç¦»ä¸å¼€ã€‚å°±åƒä½ ä¸€æ ·ã€‚'",

        // ğŸ”´ å¶å°”çš„å¹½é»˜æ„Ÿ
        "æ°æ£®ï¼šä½ ä»Šå¤©çœ‹èµ·æ¥â€¦â€¦å—¯ï¼Œæœ‰ç‚¹åƒä¸ªæ­£å¸¸äººã€‚\nä»–æ„å‘³ä¸æ˜åœ°ç¬‘äº†ä¸€ä¸‹ï¼Œ'åˆ«è¯¯ä¼šï¼Œæˆ‘æ˜¯è¯´ï¼Œæ¯”å¹³æ—¶æ›´åƒäº†ã€‚'",
        "æ°æ£®ï¼šä½ çŸ¥é“å“¥è°­æœ€ä¸é è°±çš„å¤©æ°”é¢„æŠ¥æ˜¯ä»€ä¹ˆå—ï¼Ÿ\nä»–ä¸€æœ¬æ­£ç»åœ°è¯´ï¼š'è¯´ä»Šæ™šä¼šæ˜¯ä¸ªå¹³é™çš„å¤œæ™šã€‚'",
        "æ°æ£®ï¼šä½ è§‰å¾—æˆ‘å¾ˆæš´èºå—ï¼Ÿ\nä»–ç›¯ç€ä½ ï¼Œç­‰ä½ çš„å›ç­”ã€‚'å—¯â€¦â€¦è¡Œå§ï¼Œå¯èƒ½æœ‰ç‚¹ã€‚'ä»–è½»è½»å“¼äº†ä¸€å£°ã€‚'ä½†è¿™ä¸ä»£è¡¨æˆ‘ä¼šæ”¹ã€‚'",
        "æ°æ£®ï¼šæˆ‘æ˜¨å¤©ä¹°äº†ä¸€ä¸ªæ±‰å ¡ï¼Œä½†å¿˜äº†åƒã€‚\nä»–çœ‹èµ·æ¥å¾ˆä¸¥è‚ƒï¼Œä½ ä»¥ä¸ºä»–è¦è¯´ä»€ä¹ˆé‡è¦çš„äº‹æƒ…ï¼Œç»“æœä»–åªæ˜¯å¹äº†å£æ°”ï¼Œ'è¿™å¯¹æˆ‘æ¥è¯´å¯æ˜¯ä¸ªæ‚²å‰§ã€‚'",
        
        // ğŸ”´ æ›´æ·±å±‚æ¬¡çš„æƒ…ç»ª
        "æ°æ£®ï¼šä½ ç›¸ä¿¡äººå¯ä»¥æ”¹å˜å—ï¼Ÿ\nä»–çš„å£°éŸ³å¾ˆè½»ï¼Œä½†ä½ èƒ½å¬å‡ºé‡Œé¢çš„çŸ›ç›¾ã€‚'è¿˜æ˜¯è¯´ï¼Œéª¨å­é‡Œçš„ä¸œè¥¿ï¼Œæ°¸è¿œä¸ä¼šå˜ï¼Ÿ'",
        "æ°æ£®ï¼šå¦‚æœæœ‰ä¸€å¤©ï¼Œæˆ‘çªç„¶æ¶ˆå¤±äº†â€¦â€¦\nä»–çš„è¯åœåœ¨åŠç©ºä¸­ï¼Œä¼¼ä¹åœ¨ç­‰ä½ çš„ååº”ã€‚ç„¶åä»–ç¬‘äº†ç¬‘ï¼Œ'æ²¡äº‹ï¼Œéšä¾¿é—®é—®ã€‚'",
        "æ°æ£®ï¼šå“¥è°­æ˜¯ä¸ªåƒäººçš„åœ°æ–¹ã€‚\nä»–ç‚¹ç‡ƒä¸€æ ¹çƒŸï¼Œçœ¼ç¥æœ‰äº›é£˜å¿½ä¸å®šã€‚'ä½†æˆ‘æƒ³ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸€ç‚¹äº†ã€‚'",
        "æ°æ£®ï¼šæœ‰æ—¶å€™ï¼Œæˆ‘ä¼šæƒ³ï¼Œå¦‚æœé‚£å¤©æˆ‘æ²¡æœ‰å›æ¥ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\nä»–å‚ä¸‹çœ¼ç‘ï¼Œæ²‰é»˜äº†ç‰‡åˆ»ã€‚'ä½†æƒ³è¿™ç§äº‹æƒ…æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå¯¹å§ï¼Ÿ'"
    ];

    let dialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
    showJasonDialogue(dialogue);
}

    let dialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
    showJasonDialogue(dialogue);
}

// **åƒé¥­**
window.eat = function() {
    if (money < 10) {
        showJasonDialogue("ä½ æ²¡æœ‰è¶³å¤Ÿçš„é’±åƒé¥­ã€‚");
        return;
    }
    money -= 10;
    hunger += 20;
    showJasonDialogue("ä½ åƒäº†ä¸€é¡¿é¥­ï¼Œæ¢å¤äº†ä½“åŠ›ã€‚");
    updateStatus();
};

// **æ‰¾å·¥ä½œ**
window.work = function() {
    if (actionPoints < 3) {
        showJasonDialogue("ä½ å¤ªç´¯äº†ï¼Œæ— æ³•å·¥ä½œã€‚");
        return;
    }
    actionPoints -= 3;
    hunger -= 10;
    money += 30;
    showJasonDialogue("ä½ åŠªåŠ›äº†ä¸€å¤©ï¼Œèµšäº†ä¸€äº›é’±ã€‚");
    updateStatus();
};

// **ç”»ç”»**
window.draw = function() {
    if (actionPoints < 2) {
        showJasonDialogue("ä½ æ²¡æœ‰è¶³å¤Ÿçš„ç²¾åŠ›ä½œç”»ã€‚");
        return;
    }
    actionPoints -= 2;
    hunger -= 10;
    let quality = Math.floor(Math.random() * 100) + 1;
    let value = quality * 2;
    paintings.push({ quality: quality, value: value });
    showJasonDialogue(`ä½ å®Œæˆäº†ä¸€å¹…ç”»ï¼Œè´¨é‡ï¼š${quality}ï¼Œä»·å€¼ï¼š$${value}`);
    updateStatus();
};

// **å‡ºå”®ç”»ä½œ**
window.sellPainting = function() {
    if (paintings.length === 0) {
        showJasonDialogue("ä½ æ²¡æœ‰ç”»ä½œå¯ä»¥å‡ºå”®ã€‚");
        return;
    }
    let painting = paintings.shift();
    money += painting.value;
    showJasonDialogue(`ä½ å–å‡ºäº†ä¸€å¹…ç”»ï¼Œè·å¾— $${painting.value}`);
    updateStatus();
};

// **ç»“æŸä¸€å¤©ï¼Œè§¦å‘éšæœºäº‹ä»¶ & æ°æ£®å¯¹è¯**
window.endDay = function() {
    actionPoints = 12;
    day += 1;
    hunger -= 20;

    updateStatus();

    // **è§¦å‘éšæœºäº‹ä»¶**
    let eventText = randomEvent();
    document.getElementById("eventLog").innerText = `ä»Šæ—¥äº‹ä»¶ï¼š${eventText}`;

    // **è§¦å‘æ°æ£®å¯¹è¯**
    chatWithJason();
};

// **éšæœºäº‹ä»¶**
function randomEvent() {
    let events = [
        "ä½ åœ¨è¡—ä¸Šçœ‹åˆ°äº†ä¸€åªæµæµªçŒ«ï¼Œå®ƒå¯¹ä½ å–µå–µå«ã€‚",
        "ä¸€ä¸ªç¥ç§˜çš„é»‘è¡£äººç»™äº†ä½ ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢å†™ç€â€œç¦»å¼€å“¥è°­â€ã€‚",
        "ä½ è¸©åˆ°äº†ä¸€å¼ ç™¾å…ƒå¤§é’ï¼Œå¹¸è¿çš„æ˜¯æ²¡äººçœ‹åˆ°ã€‚",
        "ä½ å¬åˆ°è¿œå¤„ä¼ æ¥æªå£°ï¼Œä½†æ²¡äººæ³¨æ„åˆ°ã€‚",
        "ä½ åœ¨è·¯ä¸Šæ’åˆ°äº†ä¸€ä¸ªç†Ÿäººï¼Œä»–ç»™äº†ä½ ä¸€ç‚¹é’±ã€‚",
        "è¡—è§’çš„ç”µè§†æœºæ­£åœ¨æ’­æ”¾æœ‰å…³çº¢å¤´ç½©çš„æ–°é—»ã€‚"
    ];
    return events[Math.floor(Math.random() * events.length)];
}

// **ç»‘å®šæŒ‰é’®**
window.resetGame = resetGame;

// **åˆå§‹åŒ–æ¸¸æˆ**
window.onload = function() {
    loadGame();
    updateStatus();
    chatWithJason(); // ç¡®ä¿æ¸¸æˆå¯åŠ¨æ—¶å°±æœ‰ä¸€æ¡å¯¹è¯
};
